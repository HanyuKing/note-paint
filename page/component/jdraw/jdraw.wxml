<view class='jdraw'>
  <view class='tool'>
    <!-- 1. 选择工具 -->
    <view class='icon-btn {{currentMode=="select"?"selected":""}}' data-mode='select' bindtap='switchMode'>👆</view>
    
    <view class="separator">|</view>

    <!-- 2. 绘画工具 (点击自动切回 draw 模式) -->
    <view class='icon-btn {{currentMode=="draw" && brushState=="p"?"selected":""}}' data-state='p' bindtap='switchBrush'>🖌️</view>
    <view class='icon-btn {{currentMode=="draw" && brushState=="c"?"selected":""}}' data-state='c' bindtap='switchBrush'>🧽</view>
    
    <view class="separator">|</view>

    <!-- 3. 其他功能 -->
    <view class='icon-btn' bindtap='chooseImage'>📷</view>
    <view class='icon-btn' bindtap='drawClear'>🗑️</view>
    <view class='icon-btn' bindtap='drawBack'>↶</view>
    <view class='icon-btn' bindtap='saveToAlbum'>💾</view>
    <view class='icon-btn help-btn' bindtap='showTutorialAgain'>
      <text class='help-text-line'>使用</text>
      <text class='help-text-line'>说明</text>
    </view>
  </view>
  <view>
    <scroll-view scroll-x="true" scroll-left="0" class='tinct-list'>
      <view wx:for='{{tinctList}}' style='background-color:{{item}}' data-index='{{index}}' bindtap='tinColorChange' class="tinct-item {{tinctCurr==index?'tinct-curr':''}}"></view>
    </scroll-view>
  </view>
  <view class="page-section page-section-gap">
    <view class="body-view">
      <slider value="{{tinctSize}}" min="1" max="10" bindchange="tinSizechange" show-value/>
    </view>
  </view>
  <view class="canvas-container">
    <canvas style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;" canvas-id="palette" bindtouchstart='touchstart' bindtouchmove='touchMove' bindtouchend='touchEnd' disable-scroll='true' hidden="{{showTutorial}}"></canvas>
    <!-- 隐形画布用于导出，尺寸动态绑定 exportWidth/Height，移出屏幕外 -->
    <canvas style="width: {{exportWidth}}px; height: {{exportHeight}}px; position: fixed; left: 10000px; top: 0;" canvas-id="exportCanvas"></canvas>


  </view>
  
  <!-- 使用说明弹窗 (回归标准 View，通过隐藏 Canvas 解决层级问题) -->
  <view class="tutorial-overlay show" wx:if="{{showTutorial}}" bindtap="closeTutorial">
    <view class="tutorial-modal">
        <view class="tutorial-header">
            <text class="tutorial-title">操作指南</text>
        </view>
        <view class="tutorial-content">
            <view class="tutorial-item">👆 顶部工具：点击直接切换【选择/画笔/橡皮】</view>
            <view class="tutorial-item">🖌️ 绘画模式：单指绘画，双指放大、缩小、扩展画布</view>
            <view class="tutorial-item">👆 选择模式：点选对象 / 空白处拖动平移</view>
            <view class="tutorial-item">📷 插入图片：点击相机图标插入</view>
            <view class="tutorial-item">💾 保存：导出全景图片到相册</view>
        </view>
        <view class="tutorial-footer">
            <button class="tutorial-btn" bindtap="closeTutorial">点击任意处关闭</button>
        </view>
    </view>
  </view>
</view>